# Курс Яндекс.Практикума «Архитектура ПО»
## Практическое задание 2-го спринта

### 2. Шардирование

Не секрет, что всё можно было бы развернуть одной командой, как это сделал Пол Дон (Paul Done):

<https://github.com/pkdone/sharded-mongodb-docker>

Но мы будем двигаться по сценарию, не предполагающему кастомных сборок mongodb. Для запуска контейнеров следует перейти в терминале в данную директорию и выполнить следующую команду.

```bash
$ docker compose up -d
```

Затем для настройки кластера нужно последовательно выполнить первые 5 скриптов из директории scripts. Первым скриптом переводится в режим набор реплик (replica set) сервер, отвечающий за обслуживание БД конфигурации.

```bash
$ scripts/01-config-rs-init.sh
```

Вторым скриптом в режим набора реплик переводится сервер, выполняющий роль шарды № 1.

```bash
$ scripts/02-shard1-rs-init.sh
```

То же для шарды № 2.

```bash
$ scripts/03-shard2-rs-init.sh
```

Четвёртый скрипт добавляет обе наши шарды специальной командой на роутере.

```bash
$ scripts/04-add-shards.sh
```

Пятым скриптом, наконец, активируется шардирование для коллекции helloDoc.

```bash
$ scripts/05-shard-collection.sh
```

Шестой скрипт добавляет в коллекцию 1000 документов.

```bash
$ scripts/06-mongo-init.sh
```

Убедиться в том, что все поставленные цели были нами достигнуты, можно открыв в броузере следующий URL:

<http://localhost:8080/>

Так же следующие 2 скрипта отобразят, как распределились между шардами вставленные 6-ым скриптом документы.

```bash
$ scripts/07-shard1-count.sh
```

```bash
$ scripts/08-shard2-count.sh
```

Остановить и удалить все контейнеры, а также почистить за ними созданные тома (volumes) призвана следующая команда:

```bash
$ docker compose down -v
```
